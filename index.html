<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>å‡ºé€€å‹¤ç®¡ç†ã‚¢ãƒ—ãƒª</title>
  <style>
    body { font-family: sans-serif; text-align: center; margin-top: 100px; }
    input, button { font-size: 1.2em; padding: 10px; margin: 10px; }
  </style>
</head>
<body>
  <h1>å‡ºé€€å‹¤ç®¡ç†</h1>
  <input type="text" id="employeeId" placeholder="ç¤¾å“¡ç•ªå·ã‚’å…¥åŠ›">
  <br>
  <button id="punchBtn">å‡ºå‹¤</button>

<script>
  // ğŸ”½ çŠ¶æ…‹ã‚’ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‹ã‚‰èª­ã¿è¾¼ã¿
  function saveStatus(isWorking) {
    localStorage.setItem("isWorking", isWorking ? "1" : "0");
  }

  function loadStatus() {
    return localStorage.getItem("isWorking") === "1";
  }

  let isWorking = loadStatus(); // â† çŠ¶æ…‹ã‚’å¾©å…ƒ
  document.getElementById("punchBtn").textContent = isWorking ? "é€€å‹¤" : "å‡ºå‹¤";

  async function getEmployeeNameFromSheet(id) {
    const url = `https://script.google.com/macros/s/AKfycbwIaHxvdk4iUDFAL6DfyB5F5wr3DiARYCc27vTKsj8TNFx8iksIGTZjEmqo0n0rSLsrXA/exec?id=${id}`;
    const res = await fetch(url);
    return await res.text();
  }

  document.getElementById("punchBtn").addEventListener("click", async function () {
    const id = document.getElementById("employeeId").value.trim();
    if (!id) {
      alert("ç¤¾å“¡ç•ªå·ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„");
      return;
    }

    const status = isWorking ? "é€€å‹¤" : "å‡ºå‹¤";
    const now = new Date();
    const dateStr = now.toLocaleDateString();
    const timeStr = now.toLocaleTimeString();
    const week = ["æ—¥", "æœˆ", "ç«", "æ°´", "æœ¨", "é‡‘", "åœŸ"];
    const weekday = week[now.getDay()];

    const name = await getEmployeeNameFromSheet(id);

    alert(
      `âœ… æ‰“åˆ»å®Œäº†\n\n` +
      `ğŸ‘¤ ç¤¾å“¡å: ${name}\n` +
      `ğŸ†” ç¤¾å“¡ç•ªå·: ${id}\n` +
      `ğŸ“Œ ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹: ${status}\n` +
      `ğŸ“… æ—¥ä»˜: ${dateStr}ï¼ˆ${weekday}æ›œæ—¥ï¼‰\n` +
      `â° æ™‚åˆ»: ${timeStr}`
    );

    // ğŸ”½ ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã«ä¿å­˜
    fetch("https://script.google.com/macros/s/AKfycbwIaHxvdk4iUDFAL6DfyB5F5wr3DiARYCc27vTKsj8TNFx8iksIGTZjEmqo0n0rSLsrXA/exec", {
      method: "POST",
      headers: {
        "Content-Type": "application/x-www-form-urlencoded"
      },
      body: new URLSearchParams({
        date: dateStr,
        time: timeStr,
        status: status,
        id: id,
        name: name
      })
    });

    isWorking = !isWorking;
    this.textContent = isWorking ? "é€€å‹¤" : "å‡ºå‹¤";
    saveStatus(isWorking); // â† ã“ã“ã§çŠ¶æ…‹ã‚’ä¿å­˜ï¼
  });
</script>
</body>
</html>